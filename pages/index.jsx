import React, { useEffect } from "react";
import Head from "next/head";
import { useRouter } from "next/router";
import { useSession, signIn } from "next-auth/react";
import { useDispatch } from "react-redux";

import { setAuthData } from "redux/actions/auth.actions";

export default function Home() {
  const router = useRouter();
  const { data: session } = useSession();
  const dispatch = useDispatch();

  const handleNavigation = (path) => {
    router.push(path);
  };

  const handleLogin = async () => {
    try {
      const callbackUrl = process.env.AUTH0_ISSUER_BASE_URL; //"dev-342qasi42nz80wtj.us.auth0.com";
      await signIn("auth0", { callbackUrl });
    } catch (error) {
      console.error("Error during login:", error);
    }
  };

  const redirectToApp = async () => {
    try {
      handleNavigation("/export-costing");
    } catch (error) {
      console.error("Error during login:", error);
    }
  };

  useEffect(() => {
    if (session && session.accessToken) {
      dispatch(setAuthData(session.user, session.accessToken));
      redirectToApp();
    }
  }, [session]);

  return (
    <React.Fragment>
      <Head>
        <meta charSet="utf-8" />
        <title>Home | pwip - Export Costing </title>

        <meta name="Reciplay" content="Reciplay" />
        <meta name="description" content="Generated by create next app" />

        <meta name="mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta
          name="apple-mobile-web-app-status-bar-style"
          content="black-translucent"
        />

        <link rel="manifest" href="/manifest.json" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <div
        className="min-h-screen flex flex-col items-center justify-center"
        style={{ background: `linear-gradient(180deg, #60baf7, #2373bf)` }}
      >
        <div className="bg-no-repeat bg-cover inline-flex flex-col justify-end h-full p-5">
          <div className="inline-flex flex-col space-y-12">
            <div className="inline-flex flex-col space-y-3">
              <h1 className="text-[36px] text-gray-50">
                Export costing
                <br />
                by pwip
              </h1>
              <span className="text-md text-gray-200">
                A team driven towards solving daily rice trade problems. Lorem
                Ipsum
              </span>
            </div>

            <div className="inline-flex flex-col space-y-3">
              <button
                onClick={() => handleLogin()}
                className="w-full rounded-full py-3 px-4 bg-white text-[#2373bf] text-center text-md font-semibold"
              >
                Login now
              </button>
            </div>
          </div>
        </div>
      </div>
    </React.Fragment>
  );
}
